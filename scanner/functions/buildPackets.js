function buildPackets(t){for(var r=t.SIZ,o=t.currentTile.index,c=t.tiles[o],l=r.Csiz,u=0;u<l;u++){for(var d=c.components[u],g=d.codingStyleParameters.decompositionLevelsCount,y=[],m=[],v=0;v<=g;v++){var w=getBlocksDimensions(0,d,v),_={},k=1<<g-v;_.trx0=Math.ceil(d.tcx0/k);_.try0=Math.ceil(d.tcy0/k);_.trx1=Math.ceil(d.tcx1/k);_.try1=Math.ceil(d.tcy1/k);_.resLevel=v;buildPrecincts(0,_,w);y.push(_);var S=void 0;if(0===v){(S={}).type="LL";S.tbx0=Math.ceil(d.tcx0/k);S.tby0=Math.ceil(d.tcy0/k);S.tbx1=Math.ceil(d.tcx1/k);S.tby1=Math.ceil(d.tcy1/k);S.resolution=_;buildCodeblocks(0,S,w);m.push(S);_.subbands=[S]}else{var C=1<<g-v+1,x=[];(S={}).type="HL";S.tbx0=Math.ceil(d.tcx0/C-.5);S.tby0=Math.ceil(d.tcy0/C);S.tbx1=Math.ceil(d.tcx1/C-.5);S.tby1=Math.ceil(d.tcy1/C);S.resolution=_;buildCodeblocks(0,S,w);m.push(S);x.push(S);(S={}).type="LH";S.tbx0=Math.ceil(d.tcx0/C);S.tby0=Math.ceil(d.tcy0/C-.5);S.tbx1=Math.ceil(d.tcx1/C);S.tby1=Math.ceil(d.tcy1/C-.5);S.resolution=_;buildCodeblocks(0,S,w);m.push(S);x.push(S);(S={}).type="HH";S.tbx0=Math.ceil(d.tcx0/C-.5);S.tby0=Math.ceil(d.tcy0/C-.5);S.tbx1=Math.ceil(d.tcx1/C-.5);S.tby1=Math.ceil(d.tcy1/C-.5);S.resolution=_;buildCodeblocks(0,S,w);m.push(S);x.push(S);_.subbands=x}}d.resolutions=y;d.subbands=m}var O=c.codingStyleDefaultParameters.progressionOrder;switch(O){case 0:c.packetsIterator=new LayerResolutionComponentPositionIterator(t);break;case 1:c.packetsIterator=new ResolutionLayerComponentPositionIterator(t);break;case 2:c.packetsIterator=new ResolutionPositionComponentLayerIterator(t);break;case 3:c.packetsIterator=new PositionComponentResolutionLayerIterator(t);break;case 4:c.packetsIterator=new ComponentPositionResolutionLayerIterator(t);break;default:throw new h("Unsupported progression order ".concat(O))}}