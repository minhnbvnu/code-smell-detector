function qne(e){var t=new QFe;e||(e={});var r=t.stream=iNe(e);r.setNoDelay(),r.on("error",function(a){t.emit("error",a)}),r.on("end",function(){t.emit("end"),t.message=function(){console.warn("Didn't write bytes to closed stream")}}),t.end=function(){return r.end(),t};var i=e.server?eNe:ZFe;return i(r,e,function(a,n){if(a)return t.emit("error",a);t.guid=n,t.emit("connect"),lD.unmarshalMessages(r,function(s){t.emit("message",s)},e)}),t._messages=[],t.message=function(a){t._messages.push(a)},t.once("connect",function(){t.state="connected";for(var a=0;a<t._messages.length;++a)r.write(lD.marshall(t._messages[a]));t._messages.length=0,t.message=function(n){r.write(lD.marshall(n))}}),t}