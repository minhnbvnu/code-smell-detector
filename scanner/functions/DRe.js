function DRe(e,t){const r=t||FRe,n=new Map,i=new Map,a=new Map,l={...fRe,...r.handlers},s={all:c,applyData:RRe,definitionById:n,footnoteById:i,footnoteCounts:a,footnoteOrder:[],handlers:l,one:u,options:r,patch:TRe,wrap:MRe};return ARe(e,function(d){if(d.type==="definition"||d.type==="footnoteDefinition"){const f=d.type==="definition"?n:i,h=String(d.identifier).toUpperCase();f.has(h)||f.set(h,d)}}),s;function u(d,f){const h=d.type,p=s.handlers[h];if(dT.call(s.handlers,h)&&p)return p(s,d,f);if(s.options.passThrough&&s.options.passThrough.includes(h)){if("children"in d){const{children:g,...b}=d,v=J0(b);return v.children=s.all(d),v}return J0(d)}return(s.options.unknownHandler||IRe)(s,d,f)}function c(d){const f=[];if("children"in d){const h=d.children;let p=-1;for(;++p<h.length;){const m=s.one(h[p],d);if(m){if(p&&h[p-1].type==="break"&&(!Array.isArray(m)&&m.type==="text"&&(m.value=WV(m.value)),!Array.isArray(m)&&m.type==="element")){const g=m.children[0];g&&g.type==="text"&&(g.value=WV(g.value))}Array.isArray(m)?f.push(...m):f.push(m)}}}return f}}