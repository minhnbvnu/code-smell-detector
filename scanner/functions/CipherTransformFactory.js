function CipherTransformFactory(o,u,g){_classCallCheck(this,CipherTransformFactory);var y=o.get("Filter");if(!(0,l.isName)(y,"Standard"))throw new c.FormatError("unknown encryption method");this.filterName=y.name;this.dict=o;var m=o.get("V");if(!Number.isInteger(m)||1!==m&&2!==m&&4!==m&&5!==m)throw new c.FormatError("unsupported encryption algorithm");this.algorithm=m;var v=o.get("Length");if(!v)if(m<=3)v=40;else{var w=o.get("CF"),_=o.get("StmF");if(w instanceof l.Dict&&_ instanceof l.Name){w.suppressEncryption=!0;var k=w.get(_.name);(v=k&&k.get("Length")||128)<40&&(v<<=3)}}if(!Number.isInteger(v)||v<40||v%8!=0)throw new c.FormatError("invalid key length");var x=(0,c.stringToBytes)(o.get("O")).subarray(0,32),O=(0,c.stringToBytes)(o.get("U")).subarray(0,32),T=o.get("P"),E=o.get("R"),M=(4===m||5===m)&&!1!==o.get("EncryptMetadata");this.encryptMetadata=M;var R,L,j=(0,c.stringToBytes)(u);if(g){if(6===E)try{g=(0,c.utf8StringToString)(g)}catch(t){(0,c.warn)("CipherTransformFactory: Unable to convert UTF8 encoded password.")}R=(0,c.stringToBytes)(g)}if(5!==m)L=prepareKeyData(j,R,x,O,T,E,v,M);else{var D=(0,c.stringToBytes)(o.get("O")).subarray(32,40),N=(0,c.stringToBytes)(o.get("O")).subarray(40,48),U=(0,c.stringToBytes)(o.get("U")).subarray(0,48),H=(0,c.stringToBytes)(o.get("U")).subarray(32,40),G=(0,c.stringToBytes)(o.get("U")).subarray(40,48),$=(0,c.stringToBytes)(o.get("OE")),X=(0,c.stringToBytes)(o.get("UE"));(0,c.stringToBytes)(o.get("Perms"));L=function createEncryptionKey20(t,r,o,c,l,u,h,d,g,y,m,v){if(r){var w=Math.min(127,r.length);r=r.subarray(0,w)}else r=[];var _;return(_=6===t?new C:new S).checkUserPassword(r,d,h)?_.getUserKey(r,g,m):r.length&&_.checkOwnerPassword(r,c,u,o)?_.getOwnerKey(r,l,u,y):null}(E,R,x,D,N,U,O,H,G,$,X)}if(!L&&!g)throw new c.PasswordException("No password given",c.PasswordResponses.NEED_PASSWORD);if(!L&&g){var q=function decodeUserPassword(r,o,c,l){for(var u=new Uint8Array(32),g=0,y=Math.min(32,r.length);g<y;++g)u[g]=r[g];for(var m=0;g<32;)u[g++]=t[m++];var v,w=d(u,0,g),_=l>>3;if(c>=3)for(m=0;m<50;++m)w=d(w,0,w.length);if(c>=3){v=o;var k=new Uint8Array(_);for(m=19;m>=0;m--){for(var S=0;S<_;++S)k[S]=w[S]^m;v=new h(k).encryptBlock(v)}}else v=new h(w.subarray(0,_)).encryptBlock(o);return v}(R,x,E,v);L=prepareKeyData(j,q,x,O,T,E,v,M)}if(!L)throw new c.PasswordException("Incorrect Password",c.PasswordResponses.INCORRECT_PASSWORD);this.encryptionKey=L;if(m>=4){var z=o.get("CF");z instanceof l.Dict&&(z.suppressEncryption=!0);this.cf=z;this.stmf=o.get("StmF")||r;this.strf=o.get("StrF")||r;this.eff=o.get("EFF")||this.stmf}}