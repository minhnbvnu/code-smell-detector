function Oue(e,t,r){var n=this;if(typeof this._opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");typeof t=="function"&&(r=t,t=void 0);var i=a(e).then(function(){var s=n._addSchema(e,void 0,t);return s.validate||l(s)});return r&&i.then(function(s){r(null,s)},r),i;function a(s){var u=s.$schema;return u&&!n.getSchema(u)?Oue.call(n,{$ref:u},!0):Promise.resolve()}function l(s){try{return n._compile(s)}catch(c){if(c instanceof gBe)return u(c);throw c}function u(c){var d=c.missingSchema;if(p(d))throw new Error("Schema "+d+" is loaded but "+c.missingRef+" cannot be resolved");var f=n._loadingSchemas[d];return f||(f=n._loadingSchemas[d]=n._opts.loadSchema(d),f.then(h,h)),f.then(function(m){if(!p(d))return a(m).then(function(){p(d)||n.addSchema(m,d,void 0,t)})}).then(function(){return l(s)});function h(){delete n._loadingSchemas[d]}function p(m){return n._refs[m]||n._schemas[m]}}}}