function Tbe(e,t,r){let i=aK(e.files),a=aK(t.files),n=null,s=t.files[0],o=[],u=s.name,l=i.get(u);if(l==null)throw new Error(`no file ${u} in old blockmap`);let p=a.get(u),c=0,{checksumToOffset:d,checksumToOldSize:f}=Ibe(i.get(u),l.offset,r),m=s.offset;for(let h=0;h<p.checksums.length;m+=p.sizes[h],h++){let g=p.sizes[h],y=p.checksums[h],S=d.get(y);S!=null&&f.get(y)!==g&&(r.warn(`Checksum ("${y}") matches, but size differs (old: ${f.get(y)}, new: ${g})`),S=void 0),S===void 0?(c++,n!=null&&n.kind===ep.DOWNLOAD&&n.end===m?n.end+=g:(n={kind:ep.DOWNLOAD,start:m,end:m+g},iK(n,o,y,h))):n!=null&&n.kind===ep.COPY&&n.end===S?n.end+=g:(n={kind:ep.COPY,start:S,end:S+g},iK(n,o,y,h))}return c>0&&r.info(`File${s.name==="file"?"":" "+s.name} has ${c} changed blocks`),o}