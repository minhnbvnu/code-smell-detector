function foe(e){return({state:t,dispatch:r})=>{if(t.readOnly)return!1;let n=t.changeByRange(i=>{let{from:a,to:l}=i,s=t.doc.lineAt(a),u=!e&&a==l&&I7e(t,a);e&&(a=l=(l<=s.to?s:t.doc.lineAt(l)).to);let c=new mb(t,{simulateBreak:a,simulateDoubleBreak:!!u}),d=wle(c,a);for(d==null&&(d=np(/^\s*/.exec(t.doc.lineAt(a).text)[0],t.tabSize));l<s.to&&/\s/.test(s.text[l-s.from]);)l++;u?{from:a,to:l}=u:a>s.from&&a<s.from+100&&!/\S/.test(s.text.slice(0,a))&&(a=s.from);let f=["",Q0(t,d)];return u&&f.push(Q0(t,c.lineIndent(s.from,-1))),{changes:{from:a,to:l,insert:qt.of(f)},range:ve.cursor(a+1+f[1].length)}});return r(t.update(n,{scrollIntoView:!0,userEvent:"input"})),!0}}