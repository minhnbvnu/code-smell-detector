function MessageHandler(t,r,o){var c=this;!function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,MessageHandler);this.sourceName=t;this.targetName=r;this.comObj=o;this.callbackId=1;this.streamId=1;this.streamSinks=Object.create(null);this.streamControllers=Object.create(null);this.callbackCapabilities=Object.create(null);this.actionHandler=Object.create(null);this._onComObjOnMessage=function(t){var r=t.data;if(r.targetName===c.sourceName)if(r.stream)c._processStreamMessage(r);else if(r.callback){var h=r.callbackId,d=c.callbackCapabilities[h];if(!d)throw new Error("Cannot resolve callback ".concat(h));delete c.callbackCapabilities[h];if(r.callback===l)d.resolve(r.data);else{if(r.callback!==u)throw new Error("Unexpected callback case");d.reject(wrapReason(r.reason))}}else{var g=c.actionHandler[r.action];if(!g)throw new Error("Unknown action from worker: ".concat(r.action));if(r.callbackId){var y=c.sourceName,m=r.sourceName;new Promise((function(t){t(g(r.data))})).then((function(t){o.postMessage({sourceName:y,targetName:m,callback:l,callbackId:r.callbackId,data:t})}),(function(t){o.postMessage({sourceName:y,targetName:m,callback:u,callbackId:r.callbackId,reason:wrapReason(t)})}))}else r.streamId?c._createStreamSink(r):g(r.data)}};o.addEventListener("message",this._onComObjOnMessage)}