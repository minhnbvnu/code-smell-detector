function procrustes(template,shape){for(var templateClone=[],shapeClone=[],i=0;i<template.length;i++)templateClone[i]=[template[i][0],template[i][1]];for(i=0;i<shape.length;i++)shapeClone[i]=[shape[i][0],shape[i][1]];shape=shapeClone,template=templateClone;for(var templateMean=[0,0],i=0;i<template.length;i++)templateMean[0]+=template[i][0],templateMean[1]+=template[i][1];templateMean[0]/=template.length,templateMean[1]/=template.length;for(var shapeMean=[0,0],i=0;i<shape.length;i++)shapeMean[0]+=shape[i][0],shapeMean[1]+=shape[i][1];shapeMean[0]/=shape.length,shapeMean[1]/=shape.length;for(var translationX=templateMean[0]-shapeMean[0],translationY=templateMean[1]-shapeMean[1],i=0;i<shape.length;i++)shape[i][0]-=shapeMean[0],shape[i][1]-=shapeMean[1];for(i=0;i<template.length;i++)template[i][0]-=templateMean[0],template[i][1]-=templateMean[1];for(var scaleS=0,i=0;i<shape.length;i++)scaleS+=shape[i][0]*shape[i][0],scaleS+=shape[i][1]*shape[i][1];scaleS=Math.sqrt(scaleS/shape.length);for(var scaleT=0,i=0;i<template.length;i++)scaleT+=template[i][0]*template[i][0],scaleT+=template[i][1]*template[i][1];for(var scaling=(scaleT=Math.sqrt(scaleT/template.length))/scaleS,i=0;i<shape.length;i++)shape[i][0]*=scaling,shape[i][1]*=scaling;for(var top=0,bottom=0,i=0;i<shape.length;i++)top+=shape[i][0]*template[i][1]-shape[i][1]*template[i][0],bottom+=shape[i][0]*template[i][0]+shape[i][1]*template[i][1];var rotation=Math.atan(top/bottom);return translationX+=shapeMean[0]-scaling*Math.cos(-rotation)*shapeMean[0]-scaling*shapeMean[1]*Math.sin(-rotation),translationY+=shapeMean[1]+scaling*Math.sin(-rotation)*shapeMean[0]-scaling*shapeMean[1]*Math.cos(-rotation),[translationX,translationY,scaling,rotation]}