function fw(e,r,t,a){var n,i;if(!((n=e[6])==null?void 0:n[0])||!((i=e[7])==null?void 0:i[0]))throw"Mutation only works on post-BNC storages!";var s=0;if(e[7][0].data.length<2*r.length){var f=new Uint8Array(2*r.length);f.set(e[7][0].data);e[7][0].data=f}if(e[4][0].data.length<2*r.length){var l=new Uint8Array(2*r.length);l.set(e[4][0].data);e[4][0].data=l}var o=yg(e[7][0].data),c=0,u=[];var h=yg(e[4][0].data),d=0,v=[];var p=a?4:1;for(var m=0;m<r.length;++m){if(r[m]==null){o.setUint16(m*2,65535,true);h.setUint16(m*2,65535);continue}o.setUint16(m*2,c/p,true);h.setUint16(m*2,d/p,true);var b,g;switch(typeof r[m]){case"string":b=Yg({t:"s",v:r[m]},t);g=Kg({t:"s",v:r[m]},t);break;case"number":b=Yg({t:"n",v:r[m]},t);g=Kg({t:"n",v:r[m]},t);break;case"boolean":b=Yg({t:"b",v:r[m]},t);g=Kg({t:"b",v:r[m]},t);break;default:throw new Error("Unsupported value "+r[m]);}u.push(b);c+=b.length;{v.push(g);d+=g.length}++s}e[2][0].data=Ig(s);e[5][0].data=Ig(5);for(;m<e[7][0].data.length/2;++m){o.setUint16(m*2,65535,true);h.setUint16(m*2,65535,true)}e[6][0].data=xg(u);e[3][0].data=xg(v);e[8]=[{type:0,data:Ig(a?1:0)}];return s}