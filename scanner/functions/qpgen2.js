function qpgen2(dmat,dvec,fddmat,n,sol,crval,amat,bvec,fdamat,q,meq,iact,nact,iter,work,ierr){function fn_goto_799(){return work[iwuv+nact]=work[iwuv+nact+1],work[iwuv+nact+1]=0,iact[nact]=0,nact-=1,iter[2]=iter[2]+1,0}var i,j,l,l1,info,it1,iwzv,iwrv,iwrm,iwsv,iwuv,nvl,r,iwnbv,temp,sum,t1,tt,gc,gs,nu,t1inf,t2min,vsmall,tmpa,tmpb,go;r=Math.min(n,q),l=2*n+r*(r+5)/2+2*q+1,vsmall=1e-60;do{tmpa=1+.1*(vsmall+=vsmall),tmpb=1+.2*vsmall}while(tmpa<=1||tmpb<=1);for(i=1;i<=n;i+=1)work[i]=dvec[i];for(i=n+1;i<=l;i+=1)work[i]=0;for(i=1;i<=q;i+=1)iact[i]=0;if(info=[],0===ierr[1]){if(dpofa(dmat,fddmat,n,info),0!==info[1])return void(ierr[1]=2);dposl(dmat,fddmat,n,dvec),dpori(dmat,fddmat,n)}else{for(j=1;j<=n;j+=1)for(sol[j]=0,i=1;i<=j;i+=1)sol[j]=sol[j]+dmat[i][j]*dvec[i];for(j=1;j<=n;j+=1)for(dvec[j]=0,i=j;i<=n;i+=1)dvec[j]=dvec[j]+dmat[j][i]*sol[i]}for(crval[1]=0,j=1;j<=n;j+=1)for(sol[j]=dvec[j],crval[1]=crval[1]+work[j]*sol[j],work[j]=0,i=j+1;i<=n;i+=1)dmat[i][j]=0;for(crval[1]=-crval[1]/2,ierr[1]=0,iwnbv=(iwsv=(iwrm=(iwuv=(iwrv=(iwzv=n)+n)+r)+r+1)+r*(r+1)/2)+q,i=1;i<=q;i+=1){for(sum=0,j=1;j<=n;j+=1)sum+=amat[j][i]*amat[j][i];work[iwnbv+i]=Math.sqrt(sum)}for(nact=0,iter[1]=0,iter[2]=0,go=0;;){if(999===(go=function(){for(iter[1]=iter[1]+1,l=iwsv,i=1;i<=q;i+=1){for(l+=1,sum=-bvec[i],j=1;j<=n;j+=1)sum+=amat[j][i]*sol[j];if(Math.abs(sum)<vsmall&&(sum=0),i>meq)work[l]=sum;else if(work[l]=-Math.abs(sum),sum>0){for(j=1;j<=n;j+=1)amat[j][i]=-amat[j][i];bvec[i]=-bvec[i]}}for(i=1;i<=nact;i+=1)work[iwsv+iact[i]]=0;for(nvl=0,temp=0,i=1;i<=q;i+=1)work[iwsv+i]<temp*work[iwnbv+i]&&(nvl=i,temp=work[iwsv+i]/work[iwnbv+i]);return 0===nvl?999:0}()))return;for(;;){if(0===(go=function(){for(i=1;i<=n;i+=1){for(sum=0,j=1;j<=n;j+=1)sum+=dmat[j][i]*amat[j][nvl];work[i]=sum}for(l1=iwzv,i=1;i<=n;i+=1)work[l1+i]=0;for(j=nact+1;j<=n;j+=1)for(i=1;i<=n;i+=1)work[l1+i]=work[l1+i]+dmat[i][j]*work[j];for(t1inf=!0,i=nact;i>=1;i-=1){for(sum=work[i],l1=(l=iwrm+i*(i+3)/2)-i,j=i+1;j<=nact;j+=1)sum-=work[l]*work[iwrv+j],l+=j;if(sum/=work[l1],work[iwrv+i]=sum,iact[i]<meq)break;if(sum<0)break;t1inf=!1,it1=i}if(!t1inf)for(t1=work[iwuv+it1]/work[iwrv+it1],i=1;i<=nact&&!(iact[i]<meq)&&!(work[iwrv+i]<0);i+=1)(temp=work[iwuv+i]/work[iwrv+i])<t1&&(t1=temp,it1=i);for(sum=0,i=iwzv+1;i<=iwzv+n;i+=1)sum+=work[i]*work[i];if(Math.abs(sum)<=vsmall){if(t1inf)return ierr[1]=1,999;for(i=1;i<=nact;i+=1)work[iwuv+i]=work[iwuv+i]-t1*work[iwrv+i];return work[iwuv+nact+1]=work[iwuv+nact+1]+t1,700}for(sum=0,i=1;i<=n;i+=1)sum+=work[iwzv+i]*amat[i][nvl];for(tt=-work[iwsv+nvl]/sum,t2min=!0,t1inf||t1<tt&&(tt=t1,t2min=!1),i=1;i<=n;i+=1)sol[i]=sol[i]+tt*work[iwzv+i],Math.abs(sol[i])<vsmall&&(sol[i]=0);for(crval[1]=crval[1]+tt*sum*(tt/2+work[iwuv+nact+1]),i=1;i<=nact;i+=1)work[iwuv+i]=work[iwuv+i]-tt*work[iwrv+i];if(work[iwuv+nact+1]=work[iwuv+nact+1]+tt,!t2min){for(sum=-bvec[nvl],j=1;j<=n;j+=1)sum+=sol[j]*amat[j][nvl];if(nvl>meq)work[iwsv+nvl]=sum;else if(work[iwsv+nvl]=-Math.abs(sum),sum>0){for(j=1;j<=n;j+=1)amat[j][nvl]=-amat[j][nvl];bvec[nvl]=-bvec[nvl]}return 700}for(iact[nact+=1]=nvl,l=iwrm+(nact-1)*nact/2+1,i=1;i<=nact-1;i+=1)work[l]=work[i],l+=1;if(nact===n)work[l]=work[n];else{for(i=n;i>=nact+1&&0!==work[i]&&(gc=Math.max(Math.abs(work[i-1]),Math.abs(work[i])),gs=Math.min(Math.abs(work[i-1]),Math.abs(work[i])),temp=work[i-1]>=0?Math.abs(gc*Math.sqrt(1+gs*gs/(gc*gc))):-Math.abs(gc*Math.sqrt(1+gs*gs/(gc*gc))),gc=work[i-1]/temp,gs=work[i]/temp,1!==gc);i-=1)if(0===gc)for(work[i-1]=gs*temp,j=1;j<=n;j+=1)temp=dmat[j][i-1],dmat[j][i-1]=dmat[j][i],dmat[j][i]=temp;else for(work[i-1]=temp,nu=gs/(1+gc),j=1;j<=n;j+=1)temp=gc*dmat[j][i-1]+gs*dmat[j][i],dmat[j][i]=nu*(dmat[j][i-1]+temp)-dmat[j][i],dmat[j][i-1]=temp;work[l]=work[nact]}return 0}()))break;if(999===go)return;if(700===go)if(it1===nact)fn_goto_799();else{for(;;)if(function(){if(l=iwrm+it1*(it1+1)/2+1,l1=l+it1,0===work[l1])return 798;if(gc=Math.max(Math.abs(work[l1-1]),Math.abs(work[l1])),gs=Math.min(Math.abs(work[l1-1]),Math.abs(work[l1])),temp=work[l1-1]>=0?Math.abs(gc*Math.sqrt(1+gs*gs/(gc*gc))):-Math.abs(gc*Math.sqrt(1+gs*gs/(gc*gc))),gc=work[l1-1]/temp,gs=work[l1]/temp,1===gc)return 798;if(0===gc){for(i=it1+1;i<=nact;i+=1)temp=work[l1-1],work[l1-1]=work[l1],work[l1]=temp,l1+=i;for(i=1;i<=n;i+=1)temp=dmat[i][it1],dmat[i][it1]=dmat[i][it1+1],dmat[i][it1+1]=temp}else{for(nu=gs/(1+gc),i=it1+1;i<=nact;i+=1)temp=gc*work[l1-1]+gs*work[l1],work[l1]=nu*(work[l1-1]+temp)-work[l1],work[l1-1]=temp,l1+=i;for(i=1;i<=n;i+=1)temp=gc*dmat[i][it1]+gs*dmat[i][it1+1],dmat[i][it1+1]=nu*(dmat[i][it1]+temp)-dmat[i][it1+1],dmat[i][it1]=temp}}(),797!==(go=function(){for(l1=l-it1,i=1;i<=it1;i+=1)work[l1]=work[l],l+=1,l1+=1;return work[iwuv+it1]=work[iwuv+it1+1],iact[it1]=iact[it1+1],it1+=1,it1<nact?797:0}()))break;fn_goto_799()}}}}