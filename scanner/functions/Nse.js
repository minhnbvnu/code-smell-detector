function Nse(e,t){if(!Fse(Hp(t,"X-Checksum-Sha2"),e.options.sha2,e.callback))return;let r=[];if(e.options.onProgress!=null){let s=Hp(t,"content-length");s!=null&&r.push(new(XD()).ProgressCallbackTransform(parseInt(s,10),e.options.cancellationToken,e.options.onProgress))}let i=e.options.sha512;i!=null?r.push(new Qg(i,"sha512",i.length===128&&!i.includes("+")&&!i.includes("Z")&&!i.includes("=")?"hex":"base64")):e.options.sha2!=null&&r.push(new Qg(e.options.sha2,"sha256","hex"));let a=(0,Ase.createWriteStream)(e.destination);r.push(a);let n=t;for(let s of r)s.on("error",o=>{e.options.cancellationToken.cancelled||e.callback(o)}),n=n.pipe(s);a.on("finish",()=>{a.close(e.callback)})}