function tX(e){var t,r;let{defaultFilter:n,menuTrigger:i="input",allowsEmptyCollection:a=!1,allowsCustomValue:l,shouldCloseOnBlur:s=!0}=e,[u,c]=O.useState(!1),[d,f]=O.useState(!1),[h,p]=O.useState(null),m=we=>{e.onSelectionChange&&e.onSelectionChange(we),we===y&&(U(),j())};var g;let{collection:b,selectionManager:v,selectedKey:y,setSelectedKey:$,selectedItem:x,disabledKeys:k}=BH({...e,onSelectionChange:m,items:(g=e.items)!==null&&g!==void 0?g:e.defaultItems});var C,A;let[E,M]=ca(e.inputValue,(A=(C=e.defaultInputValue)!==null&&C!==void 0?C:(t=b.getItem(y))===null||t===void 0?void 0:t.textValue)!==null&&A!==void 0?A:"",e.onInputChange),D=b,T=O.useMemo(()=>e.items!=null||!n?b:U0e(b,E,n),[b,E,n,e.items]),[B,R]=O.useState(T),_=O.useRef("focus"),W=Hh({...e,onOpenChange:we=>{e.onOpenChange&&e.onOpenChange(we,we?_.current:void 0),v.setFocused(we),we||v.setFocusedKey(null)},isOpen:void 0,defaultOpen:void 0}),Z=(we=null,Ce)=>{let xe=Ce==="manual"||Ce==="focus"&&i==="focus";(a||T.size>0||xe&&D.size>0||e.items)&&(xe&&!W.isOpen&&e.items===void 0&&c(!0),_.current=Ce,p(we),W.open())},K=(we=null,Ce)=>{let xe=Ce==="manual"||Ce==="focus"&&i==="focus";!(a||T.size>0||xe&&D.size>0||e.items)&&!W.isOpen||(xe&&!W.isOpen&&e.items===void 0&&c(!0),W.isOpen||(_.current=Ce),F(we))},q=O.useCallback(()=>{R(u?D:T)},[u,D,T]),F=O.useCallback((we=null)=>{W.isOpen&&q(),p(we),W.toggle()},[W,q]),j=O.useCallback(()=>{W.isOpen&&(q(),W.close())},[W,q]),[Q,I]=O.useState(E),U=()=>{var we,Ce;let xe=(Ce=(we=b.getItem(y))===null||we===void 0?void 0:we.textValue)!==null&&Ce!==void 0?Ce:"";I(xe),M(xe)};var ee,ue;let se=O.useRef((ue=(ee=e.selectedKey)!==null&&ee!==void 0?ee:e.defaultSelectedKey)!==null&&ue!==void 0?ue:null);var Se;let nt=O.useRef((Se=(r=b.getItem(y))===null||r===void 0?void 0:r.textValue)!==null&&Se!==void 0?Se:"");O.useEffect(()=>{var we;d&&(T.size>0||a)&&!W.isOpen&&E!==Q&&i!=="manual"&&Z(null,"input"),!u&&!a&&W.isOpen&&T.size===0&&j(),y!=null&&y!==se.current&&j(),E!==Q&&(v.setFocusedKey(null),c(!1),E===""&&(e.inputValue===void 0||e.selectedKey===void 0)&&$(null)),y!==se.current&&(e.inputValue===void 0||e.selectedKey===void 0)?U():Q!==E&&I(E);var Ce;let xe=(Ce=(we=b.getItem(y))===null||we===void 0?void 0:we.textValue)!==null&&Ce!==void 0?Ce:"";!d&&y!=null&&e.inputValue===void 0&&y===se.current&&nt.current!==xe&&(I(xe),M(xe)),se.current=y,nt.current=xe});let ge=Rs({...e,value:O.useMemo(()=>({inputValue:E,selectedKey:y}),[E,y])}),Te=()=>{l&&y==null?jt():Et()},jt=()=>{se.current=null,$(null),j()},Et=()=>{if(e.selectedKey!==void 0&&e.inputValue!==void 0){var we;e.onSelectionChange(y);var Ce;let xe=(Ce=(we=b.getItem(y))===null||we===void 0?void 0:we.textValue)!==null&&Ce!==void 0?Ce:"";I(xe),j()}else U(),j()};const mt=()=>{if(l){var we,Ce;const xe=(Ce=(we=b.getItem(y))===null||we===void 0?void 0:we.textValue)!==null&&Ce!==void 0?Ce:"";E===xe?Et():jt()}else Et()};let Wt=()=>{W.isOpen&&v.focusedKey!=null?y===v.focusedKey?Et():$(v.focusedKey):mt()},Lt=O.useRef(E),Zt=we=>{we?(Lt.current=E,i==="focus"&&Z(null,"focus")):(s&&mt(),E!==Lt.current&&ge.commitValidation()),f(we)},it=O.useMemo(()=>W.isOpen?u?D:T:B,[W.isOpen,D,T,u,B]);return{...ge,...W,focusStrategy:h,toggle:K,open:Z,close:mt,selectionManager:v,selectedKey:y,setSelectedKey:$,disabledKeys:k,isFocused:d,setFocused:Zt,selectedItem:x,collection:it,inputValue:E,setInputValue:M,commit:Wt,revert:Te}}