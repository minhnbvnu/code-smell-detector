function Rpe(e,t,r){const n=O.useRef(typeof document<"u"?rn(e.current?e.current[0]:void 0).activeElement:null);St(()=>{let i=e.current;const a=rn(i?i[0]:void 0);if(!t||r)return;let l=()=>{(!br||Ug(br,e))&&ai(a.activeElement,e.current)&&(br=e)};return a.addEventListener("focusin",l,!1),i==null||i.forEach(s=>s.addEventListener("focusin",l,!1)),()=>{a.removeEventListener("focusin",l,!1),i==null||i.forEach(s=>s.removeEventListener("focusin",l,!1))}},[e,r]),St(()=>{const i=rn(e.current?e.current[0]:void 0);if(!t)return;let a=l=>{if(l.key!=="Tab"||l.altKey||l.ctrlKey||l.metaKey||!df(e))return;let s=i.activeElement;if(!ai(s,e.current))return;let u=cn.getTreeNode(e);if(!u)return;let c=u.nodeToRestore,d=ta(i.body,{tabbable:!0});d.currentNode=s;let f=l.shiftKey?d.previousNode():d.nextNode();if((!c||!i.body.contains(c)||c===i.body)&&(c=void 0,u.nodeToRestore=void 0),(!f||!ai(f,e.current))&&c){d.currentNode=c;do f=l.shiftKey?d.previousNode():d.nextNode();while(ai(f,e.current));l.preventDefault(),l.stopPropagation(),f?oo(f,!0):lU(c)?oo(c,!0):s.blur()}};return r||i.addEventListener("keydown",a,!0),()=>{r||i.removeEventListener("keydown",a,!0)}},[e,t,r]),St(()=>{const i=rn(e.current?e.current[0]:void 0);if(!t)return;let a=cn.getTreeNode(e);if(a){var l;return a.nodeToRestore=(l=n.current)!==null&&l!==void 0?l:void 0,()=>{let s=cn.getTreeNode(e);if(!s)return;let u=s.nodeToRestore;if(t&&u&&(ai(i.activeElement,e.current)||i.activeElement===i.body&&Tpe(e))){let c=cn.clone();requestAnimationFrame(()=>{if(i.activeElement===i.body){let d=c.getTreeNode(e);for(;d;){if(d.nodeToRestore&&d.nodeToRestore.isConnected){oo(d.nodeToRestore);return}d=d.parent}for(d=c.getTreeNode(e);d;){if(d.scopeRef&&d.scopeRef.current&&cn.getTreeNode(d.scopeRef)){qg(d.scopeRef.current,!0);return}d=d.parent}}})}}}},[e,t])}