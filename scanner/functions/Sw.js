function Sw(e,r){$e();r=r||{};gw(r);if(Dr(e,"META-INF/manifest.xml"))return pg(e,r);if(Dr(e,"objectdata.xml"))return pg(e,r);if(Dr(e,"Index/Document.iwa")){if(typeof Uint8Array=="undefined")throw new Error("NUMBERS file parsing requires Uint8Array support");if(typeof sw!="undefined"){if(e.FileIndex)return sw(e,r);var t=er.utils.cfb_new();Br(e).forEach(function(r){Wr(t,r,Ur(e,r))});return sw(t,r)}throw new Error("Unsupported NUMBERS file")}if(!Dr(e,"[Content_Types].xml")){if(Dr(e,"index.xml.gz"))throw new Error("Unsupported NUMBERS 08 file");if(Dr(e,"index.xml"))throw new Error("Unsupported NUMBERS 09 file");var a=er.find(e,"Index.zip");if(a){r=yr(r);delete r.type;if(typeof a.content=="string")r.type="binary";if(typeof Bun!=="undefined"&&Buffer.isBuffer(a.content))return Lw(new Uint8Array(a.content),r);return Lw(a.content,r)}throw new Error("Unsupported ZIP file")}var n=Br(e);var i=ai(Mr(e,"[Content_Types].xml"));var s=false;var f,l;if(i.workbooks.length===0){l="xl/workbook.xml";if(Lr(e,l,true))i.workbooks.push(l)}if(i.workbooks.length===0){l="xl/workbook.bin";if(!Lr(e,l,true))throw new Error("Could not find workbook");i.workbooks.push(l);s=true}if(i.workbooks[0].slice(-3)=="bin")s=true;var o={};var c={};if(!r.bookSheets&&!r.bookProps){Zd=[];if(i.sst)try{Zd=Gm(Lr(e,yw(i.sst)),i.sst,r)}catch(u){if(r.WTF)throw u}if(r.cellStyles&&i.themes.length)o=Wc(Mr(e,i.themes[0].replace(/^\//,""),true)||"",r);if(i.style)c=Vm(Lr(e,yw(i.style)),i.style,o,r)}i.links.map(function(t){try{var a=fi(Mr(e,si(yw(t))),t);return Xm(Lr(e,yw(t)),a,t,r)}catch(n){}});var h=Um(Lr(e,yw(i.workbooks[0])),i.workbooks[0],r);var d={},v="";if(i.coreprops.length){v=Lr(e,yw(i.coreprops[0]),true);if(v)d=wi(v);if(i.extprops.length!==0){v=Lr(e,yw(i.extprops[0]),true);if(v)_i(v,d,r)}}var p={};if(!r.bookSheets||r.bookProps){if(i.custprops.length!==0){v=Mr(e,yw(i.custprops[0]),true);if(v)p=Ci(v,r)}}var m={};if(r.bookSheets||r.bookProps){if(h.Sheets)f=h.Sheets.map(function I(e){return e.name});else if(d.Worksheets&&d.SheetNames.length>0)f=d.SheetNames;if(r.bookProps){m.Props=d;m.Custprops=p}if(r.bookSheets&&typeof f!=="undefined")m.SheetNames=f;if(r.bookSheets?m.SheetNames:r.bookProps)return m}f={};var b={};if(r.bookDeps&&i.calcchain)b=jm(Lr(e,yw(i.calcchain)),i.calcchain,r);var g=0;var w={};var k,T;{var E=h.Sheets;d.Worksheets=E.length;d.SheetNames=[];for(var y=0;y!=E.length;++y){d.SheetNames[y]=E[y].name}}var S=s?"bin":"xml";var _=i.workbooks[0].lastIndexOf("/");var A=(i.workbooks[0].slice(0,_+1)+"_rels/"+i.workbooks[0].slice(_+1)+".rels").replace(/^\//,"");if(!Dr(e,A))A="xl/_rels/workbook."+S+".rels";var x=fi(Mr(e,A,true),A.replace(/_rels.*/,"s5s"));if((i.metadata||[]).length>=1){r.xlmeta=Ym(Lr(e,yw(i.metadata[0])),i.metadata[0],r)}if((i.people||[]).length>=1){r.people=ku(Lr(e,yw(i.people[0])),r)}if(x)x=Tw(x,h.Sheets);var C=Lr(e,"xl/worksheets/sheet.xml",true)?1:0;e:for(g=0;g!=d.Worksheets;++g){var O="sheet";if(x&&x[g]){k="xl/"+x[g][1].replace(/[\/]?xl\//,"");if(!Dr(e,k))k=x[g][1];if(!Dr(e,k))k=A.replace(/_rels\/.*$/,"")+x[g][1];O=x[g][2]}else{k="xl/worksheets/sheet"+(g+1-C)+"."+S;k=k.replace(/sheet0\./,"sheet.")}T=k.replace(/^(.*)(\/)([^\/]*)$/,"$1/_rels/$3.rels");if(r&&r.sheets!=null)switch(typeof r.sheets){case"number":if(g!=r.sheets)continue e;break;case"string":if(d.SheetNames[g].toLowerCase()!=r.sheets.toLowerCase())continue e;break;default:if(Array.isArray&&Array.isArray(r.sheets)){var R=false;for(var N=0;N!=r.sheets.length;++N){if(typeof r.sheets[N]=="number"&&r.sheets[N]==g)R=1;if(typeof r.sheets[N]=="string"&&r.sheets[N].toLowerCase()==d.SheetNames[g].toLowerCase())R=1}if(!R)continue e};}Ew(e,k,T,d.SheetNames[g],g,w,f,O,r,h,o,c)}m={Directory:i,Workbook:h,Props:d,Custprops:p,Deps:b,Sheets:f,SheetNames:d.SheetNames,Strings:Zd,Styles:c,Themes:o,SSF:yr(Z)};if(r&&r.bookFiles){if(e.files){m.keys=n;m.files=e.files}else{m.keys=[];m.files={};e.FullPaths.forEach(function(r,t){r=r.replace(/^Root Entry[\/]/,"");m.keys.push(r);m.files[r]=e.FileIndex[t]})}}if(r&&r.bookVBA){if(i.vba.length>0)m.vbaraw=Lr(e,yw(i.vba[0]),true);else if(i.defaults&&i.defaults.bin===Cu)m.vbaraw=Lr(e,"xl/vbaProject.bin",true)}m.bookType=s?"xlsb":"xlsx";return m}