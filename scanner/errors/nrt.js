function nrt(n,t,e){let i={},r=new Float32Array(8),o=new WeakMap,s=new j,a=[];for(let c=0;c<8;c++)a[c]=[c,0];function l(c,u,h,p){let d=c.morphTargetInfluences;if(t.isWebGL2===!0){let f=u.morphAttributes.position.length,m=o.get(u);if(m===void 0||m.count!==f){let I=function(){D.dispose(),o.delete(u),u.removeEventListener("dispose",I)};m!==void 0&&m.texture.dispose();let v=u.morphAttributes.normal!==void 0,b=u.morphAttributes.position,y=u.morphAttributes.normal||[],_=u.attributes.position.count,S=v===!0?2:1,E=_*S,M=1;E>t.maxTextureSize&&(M=Math.ceil(E/t.maxTextureSize),E=t.maxTextureSize);let P=new Float32Array(E*M*4*f),D=new Kp(P,E,M,f);D.format=ni,D.type=ba,D.needsUpdate=!0;let w=S*4;for(let N=0;N<f;N++){let L=b[N],O=y[N],z=E*M*4*N;for(let V=0;V<L.count;V++){s.fromBufferAttribute(L,V),L.normalized===!0&&qD(s,L);let $=V*w;P[z+$+0]=s.x,P[z+$+1]=s.y,P[z+$+2]=s.z,P[z+$+3]=0,v===!0&&(s.fromBufferAttribute(O,V),O.normalized===!0&&qD(s,O),P[z+$+4]=s.x,P[z+$+5]=s.y,P[z+$+6]=s.z,P[z+$+7]=0)}}m={count:f,texture:D,size:new Mt(E,M)},o.set(u,m),u.addEventListener("dispose",I)}let x=0;for(let v=0;v<d.length;v++)x+=d[v];let g=u.morphTargetsRelative?1:1-x;p.getUniforms().setValue(n,"morphTargetBaseInfluence",g),p.getUniforms().setValue(n,"morphTargetInfluences",d),p.getUniforms().setValue(n,"morphTargetsTexture",m.texture,e),p.getUniforms().setValue(n,"morphTargetsTextureSize",m.size)}else{let f=d===void 0?0:d.length,m=i[u.id];if(m===void 0||m.length!==f){m=[];for(let y=0;y<f;y++)m[y]=[y,0];i[u.id]=m}for(let y=0;y<f;y++){let _=m[y];_[0]=y,_[1]=d[y]}m.sort(ert);for(let y=0;y<8;y++)y<f&&m[y][1]?(a[y][0]=m[y][0],a[y][1]=m[y][1]):(a[y][0]=Number.MAX_SAFE_INTEGER,a[y][1]=0);a.sort(trt);let x=u.morphAttributes.position,g=u.morphAttributes.normal,v=0;for(let y=0;y<8;y++){let _=a[y],S=_[0],E=_[1];S!==Number.MAX_SAFE_INTEGER&&E?(x&&u.getAttribute("morphTarget"+y)!==x[S]&&u.setAttribute("morphTarget"+y,x[S]),g&&u.getAttribute("morphNormal"+y)!==g[S]&&u.setAttribute("morphNormal"+y,g[S]),r[y]=E,v+=E):(x&&u.hasAttribute("morphTarget"+y)===!0&&u.deleteAttribute("morphTarget"+y),g&&u.hasAttribute("morphNormal"+y)===!0&&u.deleteAttribute("morphNormal"+y),r[y]=0)}let b=u.morphTargetsRelative?1:1-v;p.getUniforms().setValue(n,"morphTargetBaseInfluence",b),p.getUniforms().setValue(n,"morphTargetInfluences",r)}}return{update:l}}